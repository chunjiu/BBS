function Editor(t){(t=t||{}).element&&(this.element=t.element),t.toolbar=t.toolbar||Editor.toolbar,t.hasOwnProperty("status")||(t.status=["lines","words","cursor"]),this.options=t,this.element&&this.render()}var toolbar=[{name:"bold",action:toggleBold},{name:"italic",action:toggleItalic},{name:"code",action:toggleCodeBlock},"|",{name:"quote",action:toggleBlockquote},{name:"unordered-list",action:toggleUnOrderedList},{name:"ordered-list",action:toggleOrderedList},"|",{name:"link",action:drawLink},{name:"image",action:drawImage},"|",{name:"info",action:"http://lab.lepture.com/editor/markdown"},{name:"preview",action:togglePreview},{name:"fullscreen",action:toggleFullScreen}];Editor.toolbar=toolbar,Editor.markdown=function(t){if(window.marked)return marked(t)},Editor.prototype.render=function(t){if(t||(t=this.element||document.getElementsByTagName("textarea")[0]),!this._rendered||this._rendered!==t){this.element=t;var e=this.options,o=this,r={};for(var n in shortcuts)!function(t){r[fixShortcut(t)]=function(e){shortcuts[t](o)}}(n);r.Enter="newlineAndIndentContinueMarkdownList",r.Tab="tabAndIndentContinueMarkdownList",r["Shift-Tab"]="shiftTabAndIndentContinueMarkdownList",this.codemirror=CodeMirror.fromTextArea(t,{mode:"markdown",theme:"paper",tabSize:"2",indentWithTabs:!0,lineNumbers:!1,autofocus:!0,extraKeys:r}),!1!==e.toolbar&&this.createToolbar(),!1!==e.status&&this.createStatusbar(),this._rendered=this.element}},Editor.prototype.createToolbar=function(t){if((t=t||this.options.toolbar)&&0!==t.length){var e=document.createElement("div");e.className="editor-toolbar";var o=this;o.toolbar={};for(var r=0;r<t.length;r++)!function(t){var r;r=t.name?createIcon(t.name,t):"|"===t?createSep():createIcon(t),t.action&&("function"==typeof t.action?r.onclick=function(e){t.action(o)}:"string"==typeof t.action&&(r.href=t.action,r.target="_blank")),o.toolbar[t.name||t]=r,e.appendChild(r)}(t[r]);var n=this.codemirror;n.on("cursorActivity",function(){var t=getState(n);for(var e in o.toolbar)!function(e){var r=o.toolbar[e];t[e]?r.className+=" active":r.className=r.className.replace(/\s*active\s*/g,"")}(e)});var i=n.getWrapperElement();return i.parentNode.insertBefore(e,i),e}},Editor.prototype.createStatusbar=function(t){if((t=t||this.options.status)&&0!==t.length){var e=document.createElement("div");e.className="editor-statusbar";for(var o,r=this.codemirror,n=0;n<t.length;n++)!function(t){var n=document.createElement("span");n.className=t,"words"===t?(n.innerHTML="0",r.on("update",function(){n.innerHTML=wordCount(r.getValue())})):"lines"===t?(n.innerHTML="0",r.on("update",function(){n.innerHTML=r.lineCount()})):"cursor"===t&&(n.innerHTML="0:0",r.on("cursorActivity",function(){o=r.getCursor(),n.innerHTML=o.line+":"+o.ch})),e.appendChild(n)}(t[n]);var i=this.codemirror.getWrapperElement();return i.parentNode.insertBefore(e,i.nextSibling),e}},Editor.prototype.value=function(t){return t?(this.codemirror.getDoc().setValue(t),this):this.codemirror.getValue()},Editor.toggleBold=toggleBold,Editor.toggleItalic=toggleItalic,Editor.toggleBlockquote=toggleBlockquote,Editor.toggleUnOrderedList=toggleUnOrderedList,Editor.toggleOrderedList=toggleOrderedList,Editor.drawLink=drawLink,Editor.drawImage=drawImage,Editor.undo=undo,Editor.redo=redo,Editor.togglePreview=togglePreview,Editor.toggleFullScreen=toggleFullScreen,Editor.prototype.toggleBold=function(){toggleBold(this)},Editor.prototype.toggleItalic=function(){toggleItalic(this)},Editor.prototype.toggleBlockquote=function(){toggleBlockquote(this)},Editor.prototype.toggleUnOrderedList=function(){toggleUnOrderedList(this)},Editor.prototype.toggleOrderedList=function(){toggleOrderedList(this)},Editor.prototype.drawLink=function(){drawLink(this)},Editor.prototype.drawImage=function(){drawImage(this)},Editor.prototype.undo=function(){undo(this)},Editor.prototype.redo=function(){redo(this)},Editor.prototype.togglePreview=function(){togglePreview(this)},Editor.prototype.toggleFullScreen=function(){toggleFullScreen(this)};