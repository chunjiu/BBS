<%-include('header')%>
  <div class="row">
    <div class="col-md-3 col-md-push-9">
      <%if(current_user){%>
        <div class="panel panel-default panelBorderNone">
          <div class="panel-heading">个人信息</div>
          <%-include('sidebar')%>
        </div>
        <div>
          <a href="/create">
             <span class="btn btn-success">发布话题</span>
          </a>
        </div>
        <%}else{%>
          <%-include('sidebar2')%>
            <%}%>
    </div>
    <div class='col-md-9 col-md-pull-3'>
      <div class="panel noborder topcinav" style="border-style:none">
        <div class="panel-heading">
          <ul class="nav nav-pills">
            <% [['全部'],['精华']].concat(tabs).forEach(function(value){%>
              <li><a href="<%=value?'/?tab=' +value : '/'%>"><%=value%></a><li>
            <%})%>
          </ul>
        </div>

        <div style="background-color:white">
          <div class="list-group">
            <%if(topic.length){%>
              <%topic.forEach(function(topic){%>
                <a class="list-group-item" style="height:60px;line-height:40px;" href="/<%=topic.id%>/tid">
                    <span title="回复数"><%=topic.reply_count%></span>/<span title="点击数"><%=topic.visit_count%></span>
                    <%if(topic.top){%>
                      <span class="TopicGood">置项</span><!--置顶贴优先，因为置顶贴也是精华贴-->
                    <%}else if(topic.good){%>
                      <span class="TopicGood">精华</span>
                    <%}else{%>
                      <span class="TopicTab"><%=topic.tab%></span>
                    <%}%>
                    <span><%=topic.title%></span>
                    <%if(!topic.reply_count){%>
                      <span class="pull-right"><%=topic.create_at_ago()%><span>
                    <%}else{%>
                      <span class="pull-right"><%=topic.last_reply_at_ago()%><span>                   
                    <%}%>
                </a>
                <% })%>
                <!--分页-->
                <nav>
                    <ul class="pagination" cureent_page=<%=current_page%>>
                      <% var base_url = '/?'+'tab='+(typeof(tab)!== 'undefined'?tab:'')+'&page='%>
                      <% if(current_page == 1){%>
                        <li class='disabled'><a href="<%=base_url%>1"><span>&laquo;</span></a></li>
                      <%}else{%>
                        <li><a href="<%=base_url%>1"><span>&laquo;</span></a></li>
                      <%}%>
                      <% var star_page = current_page - 4 > 0 ? current_page - 4: 1;
                         var end_page =  star_page + 7 >= pages ? pages:star_page+7;
                       %>
                      <% for(var i=star_page;i<=end_page;i++){%>
                        <li><a class="page" href="<%=base_url%><%=i%>"><%=i%></a></li>
                      <%}%>
                      <%if(current_page==pages){%>
                        <li class="disabled"><a href="<%=base_url%><%=pages%>"><span>&raquo;</span></a></li>
                      <%}else{%>
                        <li><a href="<%=base_url%><%=pages%>"><span>&raquo;</span></a></li>
                      <%}%>
                      <li style="visibility:hidden;" ><a class="pageJump" url=<%=base_url%>><button id="pp"></button></a> <!--button标签需在a标签里面，可用于a标签的自动触发事件--> <li>
                      <div class="input-group" style="width:20%;">
                        <span class="input-group-addon">跳转到</span>
                        <select class="form-control">
                            <option><%=current_page%>页</option>
                          <% for(var i=0;i<=pages;i++){%>
                            <option><%=i%>页</option>
                         <% }%>
                        </select>
                       </div> 
                               
                    </ul>
      
                  </nav>

            <%}else{%>
              <div class="inner">
                <p>无话题</p>
              </div>
            <%}%>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
  <!--col-sm-8-->
  </div>
  <!--row-->
  <%-include('footer')%>
  <script>

      var $nav = $('.pagination');
      var current_page = $nav.attr('cureent_page');
      $nav.find('li').each(function(){
       var $li = $(this);
       var $a = $li.find('a');
       if($a.html()==current_page){
         $li.addClass('active');
         $a.removeAttr('href');
       }
      });

      $('select').change(function(){
        var page =$(this).val();
        var url = $('.pageJump').attr('url');
        $('.pageJump').attr('href',url+page)
        $('#pp').trigger('click');//自动触发a标签的点击事件，并跳转到href地址,注意需要buttom标签在a标签里面
      }); 

  </script>